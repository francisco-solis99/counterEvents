var h=Object.defineProperty;var c=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;var u=(e,n,t)=>n in e?h(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,o=(e,n)=>{for(var t in n||(n={}))m.call(n,t)&&u(e,t,n[t]);if(c)for(var t of c(n))g.call(n,t)&&u(e,t,n[t]);return e};const p=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}};p();function d(e,n){this.model=e,this.view=n,this.view.bindAddEvent(this.handlerAddEvent.bind(this)),this.view.bindDeleteEvent(this.handlerDeleteEvent.bind(this)),this.model.bindEventsChanges(this.onEventsChanges.bind(this)),this.view.bindUpdateOrder(this.handlerDragAndDrop.bind(this)),this.handlerInitRender(),this.view.bindDragAndDropItems()}d.prototype={constructor:d,handlerAddEvent({title:e,date:n}){this.model.addEvent(e,n),this.model.getEvents().length===1?(this.view.areEvents=!0,this.view.renderResumeEvents(this.model.generateSeparetedEvents())):this.view.updateResume(this.model.generateSeparetedEvents())},handlerDeleteEvent(e){this.model.deleteEvent(e),this.view.updateResume(this.model.generateSeparetedEvents())},handlerFilterViews(e){const t=this.model.generateSeparetedEvents()[e];this.view.renderFilterEvents(t)},handlerDragAndDrop(e){console.log("do something with model"),this.model.reOrderEvents(e)},onEventsChanges(e,n){return e==="addEvent"?this.view.addEvent(n):e==="deleteEvent"?this.view.deleteEvent(n):console.info("Check your request action and try again \u{1F600}")},handlerInitRender(){this.model.updateDates(),this.view.renderInitialEvents(this.model.getEvents()),this.view.areEvents&&(this.view.renderResumeEvents(this.model.generateSeparetedEvents()),this.view.bindViewsEvents(this.handlerFilterViews.bind(this)))}};function l(){var e;this.eventsList=(e=JSON.parse(localStorage.getItem("events")))!=null?e:[],this.actionToBind=null}l.prototype={constructor:l,addEvent(e,n){const t=this.getDaysLeftForEvent(n),s={id:this.eventsList.length?this.eventsList[this.eventsList.length-1].id+1:0,title:e,date:n,daysForEvent:t};this.eventsList.push(s),this.saveEventsList(),this.actionToBind("addEvent",o({},s))},reOrderEvents(e){this.eventsList=this.eventsList.map((n,t,s)=>s.find(r=>r.title===e[t])),this.saveEventsList()},updateDates(){!this.eventsList.length||(this.eventsList.forEach(e=>{e.daysForEvent=this.getDaysLeftForEvent(e.date)}),this.saveEventsList())},getDaysLeftForEvent(e){const t=new Date(new Date(Date.now()).toDateString()).getTime(),s=Date.parse(e);console.log(t,s);const r=Math.ceil((s-t)/864e5);return console.log(s,r),r},getEvents(){return[...this.eventsList]},getEventIndexById(e){return this.eventsList.findIndex(n=>n.id===+e)},deleteEvent(e){const n=this.getEventIndexById(e),t=this.eventsList[n];this.eventsList.splice(n,1),this.saveEventsList(),this.actionToBind("deleteEvent",o({},t))},saveEventsList(){localStorage.setItem("events",JSON.stringify([...this.eventsList]))},bindEventsChanges(e){this.actionToBind=e},generateSeparetedEvents(){const e=this.eventsList.reduce((n,t)=>(t.daysForEvent>=0?n.nextEvents.push(o({},t)):n.passedEvents.push(o({},t)),n),{passedEvents:[],nextEvents:[]});return e.allEvents=[...e.nextEvents,...e.passedEvents],e}};function v(){this.counterEventForm=document.querySelector(".counter-event__form"),this.eventsListHtml=document.querySelector(".counter-event__list"),this.areEvents=!1,this.currentItem=null,this.orderToBind=null}v.prototype={constructor:v,bindAddEvent(e){this.counterEventForm.addEventListener("submit",n=>{n.preventDefault();const t=Object.fromEntries(new FormData(n.target));e(t),n.target.reset()})},bindDeleteEvent(e){this.eventsListHtml.addEventListener("click",n=>{if(!n.target.classList.contains("counter-event__button"))return;const t=n.target.parentNode.id;e(t)})},bindViewsEvents(e){document.querySelector(".counter-event__resume-views").addEventListener("click",t=>{if(t.target.type==="radio"){const s=t.target.value;e(s)}})},bindDragAndDropItems(){this.getEventItems().forEach(n=>{this.addDragAndDropListeners(n)})},addDragAndDropListeners(e){e.addEventListener("dragstart",this.dragAndDropActions("handlerDragStart").bind(this)),e.addEventListener("dragend",this.dragAndDropActions("handlerDragEnd")),e.addEventListener("dragover",this.dragAndDropActions("handlerDragOver")),e.addEventListener("drop",this.dragAndDropActions("handlerDrop").bind(this)),e.addEventListener("dragenter",this.dragAndDropActions("handlerDragEnter")),e.addEventListener("dragleave",this.dragAndDropActions("handlerDragLeave"))},bindUpdateOrder(e){this.orderToBind=e},getEventItems(){return document.querySelectorAll("li.couter-event__item")},dragAndDropActions(e){return{handlerDragStart(t){t.target.classList.add("isDrag"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",t.target.innerHTML),this.currentItem=t.target},handlerDragEnd(t){t.target.classList.remove("isDrag")},handlerDragOver(t){t.preventDefault(),t.stopPropagation()},handlerDrop(t){t.target.style.background="transparent";const s=t.dataTransfer.getData("text/html");t.target!==this.currentItem&&t.target.classList.contains("couter-event__item")&&(this.currentItem.innerHTML=t.target.innerHTML,t.target.innerHTML=s);const i=[...this.eventsListHtml.querySelectorAll(".counter-event__name")].map(a=>a.textContent);this.orderToBind(i)},handlerDragEnter(t){t.target.style.background="hsl(234deg 39% 55%)"},handlerDragLeave(t){t.target.style.background="transparent"}}[e]},addEvent(e){this.eventsListHtml.querySelector(".counter-event__default-msg")&&(this.eventsListHtml.innerHTML="");const n=this.createEvent(e);this.addDragAndDropListeners(n),this.eventsListHtml.appendChild(n)},deleteEvent({id:e}){const n=document.querySelector(`li[id="${e}"]`),t=this;setTimeout(function(){n.classList.add("couter-event__item-delated"),n.onanimationend=function(){n.remove()},t.eventsListHtml.querySelector("li")||(setTimeout(()=>t.renderDefaultMessage("No more events \u{1F603}"),400),t.areEvents=!1)},200)},createEvent({id:e,title:n,date:t,daysForEvent:s}){const r=document.createElement("li");r.id=e,r.classList.add("couter-event__item"),r.draggable="true";const i=s===1||s===-1?"day":s?"days":"";return r.innerHTML=`
        <p class="counter-event__days"><span>${Math.abs(s)||"Today"}</span> ${i} ${s>=0?"":"ago"}</p>
        <p class="counter-event__name">${n}</p>
        <p class="counter-event__date">${t}</p>
        <button type="button" class="counter-event__button">Eliminar</button>
    `,r},renderDefaultMessage(e){const n=document.createElement("h2");n.classList.add("counter-event__default-msg"),n.innerText=e,this.eventsListHtml.appendChild(n)},renderInitialEvents(e){if(!e.length){this.renderDefaultMessage("Not Events yet \u{1F600}");return}this.areEvents=!0;const n=document.createDocumentFragment();e.forEach(t=>n.appendChild(this.createEvent(t))),this.eventsListHtml.appendChild(n)},renderResumeEvents({allEvents:e,nextEvents:n,passedEvents:t}){const s=document.createElement("div");s.classList.add("counter-event__resume"),s.innerHTML=`
      <span class="counter-event__resume-total">${e.length} total events</span>
      <div class="counter-event__resume-views">
        <label for="view1" class="view-label">
          <input type="radio" name="resume-views" id="view1" value="allEvents"  checked>
          <span>All events</span>
        </label>

        <label for="view2" class="view-label">
          <input type="radio" name="resume-views" id="view2" value="passedEvents" >
          <span>Passed Events</span>
        </label>

        <label for="view3" class="view-label">
          <input type="radio" name="resume-views" id="view3" value="nextEvents" >
          <span>Next Events</span>
        </label>
      </div>
      <div class="counter-event__resume-stats">
        <span class="counter-event__resume-stat"><mark>${n.length} events will pass</mark></span>
        <span class="counter-event__resume-stat"><mark>${t.length} events passed</mark></span>
      </div>
    `,document.querySelector("main").appendChild(s)},updateResume({allEvents:e,nextEvents:n,passedEvents:t}){const s=document.querySelector(".counter-event__resume");s.querySelector(".counter-event__resume-total").textContent=e.length+" total events",s.querySelector(".counter-event__resume-stat:first-child mark").textContent=n.length+" events will pass",s.querySelector(".counter-event__resume-stat:last-child mark").textContent=t.length+" events passed"},renderFilterEvents(e){const n=this.eventsListHtml.querySelectorAll("li.couter-event__item"),t=e.map(s=>s.id);console.log(n),console.log(t),n.forEach(s=>{if(t.includes(+s.id)){s.style.display="grid";return}console.log("oculto para el evento => "+s.id),setTimeout(function(){s.classList.add("couter-event__item-delated"),s.onanimationend=function(r){r.animationName==="fadeOut"&&(s.style.display="none",s.classList.remove("couter-event__item-delated"))}},100)})}};const E=new d(new l,new v);console.log(E);
